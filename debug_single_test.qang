// Test just the failing optional map expressions
fn test_optional_map_expressions() {
  // With non-nil values
  assert_eq(42?|n -> n + 1|, 43);
  assert_eq("hello"?|s -> s + "!"|, "hello!");
  assert(true?|b -> !b| == false);
  
  // With nil values (should all return nil)
  assert_eq(nil?|n -> n + 1|, nil);
  assert_eq(nil?|s -> s + "!"|, nil);
  assert_eq(nil?|x -> x.property|, nil);
  assert_eq(nil?|x -> some_function(x)|, nil);
  
  // Complex expressions with nil
  var maybe_obj = nil;
  assert_eq(maybe_obj?|o -> o.value * 1000|, nil);
  
  // Chained optional maps
  var obj = {{ value = 5 }};
  assert_eq(obj?|o -> o.value|?|n -> n * 2|, 10);
  
  // Optional map with nil in chain
  var nil_obj = nil;
  assert_eq(nil_obj?|o -> o.value|?|n -> n * 2|, nil);
}

test_optional_map_expressions();